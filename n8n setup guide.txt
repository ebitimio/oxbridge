# N8n WhatsApp AI Study Assistant - Setup Guide

## Overview
This guide walks you through setting up an automated AI study assistant that connects your OXBRIDGE LMS with WhatsApp using N8n and OpenAI.

---

## Prerequisites
You'll need accounts/API keys for:
1. **N8n** (self-hosted or cloud)
2. **WhatsApp Business API**
3. **OpenAI** (GPT-4)
4. **Google Sheets** (optional, for logging)

---

## Step 1: Set Up N8n Workflow

### 1.1 Import the JSON Workflow
1. Go to your N8n dashboard
2. Click **Create â†’ New Workflow**
3. Click the menu (three dots) â†’ **Import from file**
4. Upload the `n8n-workflow.json` file provided
5. Click **Save**

### 1.2 Configure Credentials

#### OpenAI Credentials
1. In the N8n editor, click on the **AI Study Assistant** node
2. Click **Create New Credential**
3. Paste your OpenAI API key
4. Save the credential

#### WhatsApp Business Cloud API
1. Click on the **Send WhatsApp Message** node
2. Click **Create New Credential**
3. Enter:
   - **Access Token**: Get from Meta Business Manager
   - **Phone Number ID**: Your WhatsApp Business phone number ID
4. Save

#### Google Sheets (Optional)
1. Click on the **Log Session to Sheet** node
2. Click **Create New Credential**
3. Authenticate with your Google account
4. Create a new Google Sheet called "Study Sessions"
5. Save the spreadsheet ID in the credential

### 1.3 Set Environment Variables
In your N8n instance, add these environment variables:

```
WHATSAPP_PHONE_NUMBER_ID=your_phone_id_here
WHATSAPP_ACCESS_TOKEN=your_access_token_here
OPENAI_API_KEY=your_openai_key_here
GOOGLE_SHEET_ID=your_sheet_id_here
```

### 1.4 Create Webhook URL
1. Click the **Start** node in the workflow
2. Copy the **Webhook URL** shown
3. You'll need this for your frontend code

---

## Step 2: Update Your Frontend Code

### 2.1 Add the N8n Webhook URL
In `landing.js`, find this line:

```javascript
const response = await fetch('YOUR_N8N_WEBHOOK_URL', {
```

Replace `YOUR_N8N_WEBHOOK_URL` with your actual N8n webhook URL from Step 1.4

### 2.2 Add the Updated CSS
Add the contents of the modal CSS file to your `style.css` file at the end.

### 2.3 Replace landing.js
Replace your current `landing.js` with the updated version that includes:
- Phone number collection
- AI study session initialization
- WhatsApp integration
- Modal dialogs

---

## Step 3: Get WhatsApp Business API Access

### 3.1 Set Up WhatsApp Business Account
1. Go to [Meta for Developers](https://developers.facebook.com/)
2. Create or select your app
3. Add **WhatsApp** product
4. Go to **Settings â†’ API Setup**
5. Get your **Phone Number ID** and **Access Token**

### 3.2 Verify Your Phone Number
1. Go to API Setup
2. Click **Manage Phone Number List**
3. Add your business phone number
4. Verify via SMS

### 3.3 Add Test Recipients
1. In Settings, add phone numbers to test the webhook
2. These numbers will receive messages in development mode

---

## Step 4: Test the Integration

### 4.1 Local Testing
1. Make sure your N8n instance is running
2. Open your landing page after logging in
3. Click "Study with AI" button
4. Enter your WhatsApp phone number (with country code)
5. You should receive a WhatsApp message

### 4.2 Production Deployment
1. Enable **Active** on the workflow
2. Set up SSL certificates
3. Update webhook credentials in Meta Business Manager
4. Test with real phone numbers

---

## Step 5: Customize the AI Prompts

To customize what the AI says to students:

### In the N8n Workflow
1. Open the **AI Study Assistant** node
2. Modify the system prompt in the "system" message:

```
You are an expert AI study assistant for an online learning platform. 
Help students understand course material from their PDFs. 
Provide clear explanations, key study points, examples, and practice questions. 
Be encouraging and adapt to the student's learning pace. 
Keep responses concise but comprehensive.
```

3. Save and test

---

## Step 6: Monitor Sessions

### View Study Sessions
1. Check your Google Sheet (if configured) for session logs
2. Each new study session creates a row with:
   - Session ID
   - Student Name
   - Course
   - Email
   - Phone
   - Start Time
   - Status

### Debug Issues
1. Go to N8n â†’ Your Workflow â†’ **Executions**
2. Click any execution to see:
   - Input data
   - Node outputs
   - Error messages
   - API responses

---

## API Data Flow

```
LMS (landing.js)
    â†“
    â†’ Sends phone + user data to N8n webhook
    â†“
N8n Workflow
    â†“
    â†’ Calls OpenAI (generates greeting/study material)
    â†“
    â†’ Sends WhatsApp message via Meta API
    â†“
    â†’ Logs to Google Sheets
    â†“
Student receives WhatsApp message
    â†“
    â†’ Student can continue conversation with AI
```

---

## Troubleshooting

### WhatsApp Message Not Sending
- âœ“ Verify phone number is in test recipients list
- âœ“ Check Access Token is valid (doesn't expire)
- âœ“ Confirm phone number format: `+[country code][number]`

### AI Not Responding
- âœ“ Check OpenAI API key is valid
- âœ“ Verify you have OpenAI credits
- âœ“ Check N8n execution logs for API errors

### Webhook Not Triggering
- âœ“ Verify N8n URL in landing.js is correct
- âœ“ Check N8n instance is running/accessible
- âœ“ Ensure webhook is active (toggle in N8n)
- âœ“ Check browser console for CORS errors

### Session Not Logging
- âœ“ Verify Google Sheet ID is correct
- âœ“ Check Google authentication is still valid
- âœ“ Ensure sheet has proper headers

---

## Security Best Practices

1. **Never commit API keys** - Use environment variables
2. **Rate limit requests** - Set N8n rate limiting
3. **Validate phone numbers** - Only format `+[0-9]{10,15}`
4. **Use HTTPS** - Always use secure connections
5. **Monitor API usage** - Check OpenAI and WhatsApp costs
6. **Rotate tokens** - Regularly update credentials

---

## Cost Considerations

- **N8n**: Free tier or self-hosted
- **OpenAI**: ~$0.01-0.05 per conversation
- **WhatsApp**: $0.005 per message (approximately)
- **Google Sheets**: Free
- **Total**: ~$0.01-0.06 per student session

---

## Next Steps

1. âœ“ Complete all setup steps
2. âœ“ Test with a small group of students
3. âœ“ Monitor responses and adjust AI prompts
4. âœ“ Scale to production
5. âœ“ Collect student feedback
6. âœ“ Iterate on the AI model and workflow

---

## Support Resources

- [N8n Documentation](https://docs.n8n.io/)
- [WhatsApp Business API Docs](https://developers.facebook.com/docs/whatsapp)
- [OpenAI API Reference](https://platform.openai.com/docs/api-reference)
- [Google Sheets API](https://developers.google.com/sheets/api)

Good luck with your OXBRIDGE AI study assistant! ðŸš€ðŸ“š